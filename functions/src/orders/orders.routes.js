const express = require("express");// å°å…¥æ¨™æ? RBAC ??Auth ä¸­é?ä»¶ï??¿æ??Šæ??„ä¸­?“ä»¶const { withAuthentication } = require("../middleware/auth.middleware");const { withTenantIsolation, withStoreIsolation, withRole } = require("../middleware/tenant.middleware");const {  getOrders,  getOrderById,  createOrder,  updateOrderStatus,  recordPayment,  getOrderStatistics,  generateOrderReceipt,  getOrderReceipt,} = require("./orders.handlers");// eslint-disable-next-line new-capconst router = express.Router();/** * @swagger * /orders: *   get: *     summary: ?²å?è¨‚å–®?—è¡¨ *     description: ?¹æ??¥è©¢?ƒæ•¸?²å?ç¬¦å?æ¢ä»¶?„è??®å?è¡? *     tags: [Orders] *     parameters: *       - name: storeId *         in: query *         description: åº—é‹ªID *         schema: *           type: string *       - name: status *         in: query *         description: è¨‚å–®?€?? *         schema: *           type: string *           enum: [pending, preparing, ready, completed, cancelled] *       - name: page *         in: query *         description: ?ç¢¼ *         schema: *           type: integer *           default: 1 *       - name: limit *         in: query *         description: æ¯é?è¨˜é??? *         schema: *           type: integer *           default: 20 *     responses: *       200: *         description: ?å??²å?è¨‚å–®?—è¡¨ *       400: *         description: è«‹æ??ƒæ•¸?¯èª¤ *       401: *         description: ?ªæ?æ¬Šè¨ª?? *       403: *         description: æ¬Šé?ä¸è¶³ */router.get("/",   withAuthentication,  withTenantIsolation,  withStoreIsolation,  withRole(["tenant_admin", "store_manager", "store_staff"]),  getOrders);/** * @swagger * /orders/{orderId}: *   get: *     summary: ?²å??¹å?è¨‚å–®è©³æ? *     description: ?¹æ?è¨‚å–®ID?²å?å®Œæ•´?„è??®è©³?? *     tags: [Orders] *     parameters: *       - name: orderId *         in: path *         required: true *         description: è¨‚å–®ID *         schema: *           type: string *     responses: *       200: *         description: ?å??²å?è¨‚å–®è©³æ? *       400: *         description: è«‹æ??ƒæ•¸?¯èª¤ *       401: *         description: ?ªæ?æ¬Šè¨ª?? *       403: *         description: æ¬Šé?ä¸è¶³ *       404: *         description: è¨‚å–®ä¸å??? */router.get("/:orderId",   withAuthentication,  withTenantIsolation,  withStoreIsolation,  withRole(["tenant_admin", "store_manager", "store_staff"]),  getOrderById);/** * @swagger * /orders: *   post: *     summary: ?µå»º?°è??? *     description: ?µå»ºä¸€?‹æ–°?„è??®ï??…å«è¨‚å–®?…ç›®?é¡§å®¢è?è¨Šç? *     tags: [Orders] *     requestBody: *       required: true *       content: *         application/json: *           schema: *             type: object *             required: *               - storeId *               - items *     responses: *       201: *         description: è¨‚å–®?µå»º?å? *       400: *         description: è«‹æ??ƒæ•¸?¯èª¤ *       401: *         description: ?ªæ?æ¬Šè¨ª?? *       403: *         description: æ¬Šé?ä¸è¶³ *       409: *         description: è³‡æ?è¡ç?ï¼Œå?åº«å?ä¸è¶³?–ç„¡æ³•è??? */router.post("/",   withAuthentication,  withTenantIsolation,  withStoreIsolation,  withRole(["tenant_admin", "store_manager", "store_staff"]),  createOrder);/** * @swagger * /orders/{orderId}/status: *   put: *     summary: ?´æ–°è¨‚å–®?€?? *     description: ?´æ–°?‡å?è¨‚å–®?„ç??‹ï?å¦‚å?å¾…è??†æ”¹?ºæ??™ä¸­ç­? *     tags: [Orders] *     parameters: *       - name: orderId *         in: path *         required: true *         description: è¨‚å–®ID *         schema: *           type: string *     requestBody: *       required: true *       content: *         application/json: *           schema: *             type: object *             required: *               - status *             properties: *               status: *                 type: string *                 enum: [pending, preparing, ready, completed, cancelled] *               reason: *                 type: string *     responses: *       200: *         description: è¨‚å–®?€?‹æ›´?°æ??? *       400: *         description: è«‹æ??ƒæ•¸?¯èª¤ *       401: *         description: ?ªæ?æ¬Šè¨ª?? *       403: *         description: æ¬Šé?ä¸è¶³ *       404: *         description: è¨‚å–®ä¸å??? *       422: *         description: ?¡æ??•ç??„ç??‹è??? */router.put("/:orderId/status",   withAuthentication,  withTenantIsolation,  withStoreIsolation,  withRole(["tenant_admin", "store_manager"]),  updateOrderStatus);/** * @swagger * /orders/{orderId}/payment: *   post: *     summary: è¨˜é?è¨‚å–®?¯ä? *     description: ?ºæ?å®šè??®è??„æ”¯ä»˜è?è¨? *     tags: [Orders] *     parameters: *       - name: orderId *         in: path *         required: true *         description: è¨‚å–®ID *         schema: *           type: string *     requestBody: *       required: true *       content: *         application/json: *           schema: *             type: object *             required: *               - paymentMethod *               - amount *     responses: *       200: *         description: ?¯ä?è¨˜é??å? *       400: *         description: è«‹æ??ƒæ•¸?¯èª¤ *       401: *         description: ?ªæ?æ¬Šè¨ª?? *       403: *         description: æ¬Šé?ä¸è¶³ *       404: *         description: è¨‚å–®ä¸å??? *       409: *         description: è¨‚å–®å·²æ”¯ä»˜æ??•æ–¼?¡æ??¯ä??„ç??? */router.post("/:orderId/payment",   withAuthentication,  withTenantIsolation,  withStoreIsolation,  withRole(["tenant_admin", "store_manager"]),  recordPayment);/** * @swagger * /orders/stats: *   get: *     summary: ?²å?è¨‚å–®çµ±è??¸æ? *     description: ?¹æ??‚é?ç¯„å?ç­‰å??¸ç²?–è??®ç›¸?œçµ±è¨ˆæ•¸?? *     tags: [Orders] *     parameters: *       - name: storeId *         in: query *         description: åº—é‹ªID *         schema: *           type: string *       - name: from *         in: query *         description: èµ·å??¥æ?ï¼ˆISO 8601?¼å?ï¼? *         schema: *           type: string *           format: date-time *       - name: to *         in: query *         description: çµæ??¥æ?ï¼ˆISO 8601?¼å?ï¼? *         schema: *           type: string *           format: date-time *       - name: groupBy *         in: query *         description: çµ±è??†ç??¹å? *         schema: *           type: string *           enum: [day, week, month] *           default: day *     responses: *       200: *         description: ?å??²å?çµ±è?è³‡æ? *       400: *         description: è«‹æ??ƒæ•¸?¯èª¤ *       401: *         description: ?ªæ?æ¬Šè¨ª?? *       403: *         description: æ¬Šé?ä¸è¶³ */router.get("/stats",   withAuthentication,  withTenantIsolation,  withRole(["tenant_admin", "store_manager"]),  getOrderStatistics);/** * @swagger * /orders/{orderId}/receipt/generate: *   post: *     summary: ?¢ç?è¨‚å–®?¶æ? *     description: ?ºæ?å®šè??®ç”¢?Ÿï??–é??°ç”¢?Ÿï??¶æ? *     tags: [Orders] *     parameters: *       - name: orderId *         in: path *         required: true *         description: è¨‚å–®ID *         schema: *           type: string *     responses: *       200: *         description: ?¶æ??¢ç?è«‹æ?å·²æ¥?? *       400: *         description: è«‹æ??ƒæ•¸?¯èª¤ *       401: *         description: ?ªæ?æ¬Šè¨ª?? *       403: *         description: æ¬Šé?ä¸è¶³ *       404: *         description: è¨‚å–®ä¸å??? */router.post("/:orderId/receipt/generate",   withAuthentication,  withTenantIsolation,  withStoreIsolation,  withRole(["tenant_admin", "store_manager"]),  generateOrderReceipt);/** * @swagger * /orders/{orderId}/receipt: *   get: *     summary: ?²å?è¨‚å–®?¶æ? *     description: ?²å??‡å?è¨‚å–®?„æ”¶?šå…§å®¹æ???? *     tags: [Orders] *     parameters: *       - name: orderId *         in: path *         required: true *         description: è¨‚å–®ID *         schema: *           type: string *     responses: *       200: *         description: ?å??²å??¶æ? *       400: *         description: è«‹æ??ƒæ•¸?¯èª¤ *       401: *         description: ?ªæ?æ¬Šè¨ª?? *       403: *         description: æ¬Šé?ä¸è¶³ *       404: *         description: è¨‚å–®?–æ”¶?šä?å­˜åœ¨ */router.get("/:orderId/receipt",   withAuthentication,  withTenantIsolation,  withStoreIsolation,  withRole(["tenant_admin", "store_manager"]),  getOrderReceipt);module.exports = router;