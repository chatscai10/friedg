# 環境變量與 Firebase Functions Config 說明

本文檔列出了「吃雞排找不早」POS系統後端 Cloud Functions 所需的環境變量和 Firebase Functions Configuration。
這些配置對於系統的正確運行至關重要，特別是與第三方服務（如 LINE Pay）的集成。

建議使用 Firebase Functions Configuration (`firebase functions:config:set key.subkey=value`) 來管理這些敏感信息，而不是直接在程式碼中硬編碼或依賴部署環境的環境變量。

## LINE Pay 集成配置

這些配置用於與 LINE Pay API v3 進行通信。

1.  **`linepay.channel_id`**
    *   **說明**：您的 LINE Pay Channel ID。
    *   **預期值格式**：一串數字，例如 `"1234567890"`。
    *   **獲取方式**：從 LINE Pay 開發者中心獲取。

2.  **`linepay.channel_secret_key`**
    *   **說明**：您的 LINE Pay Channel Secret Key，用於生成 API 請求簽名。
    *   **預期值格式**：一長串字母數字字符，例如 `"a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"`。
    *   **獲取方式**：從 LINE Pay 開發者中心獲取。

3.  **`linepay.api_url`**
    *   **說明**：LINE Pay API 的基礎 URL。
    *   **預期值格式**：URL字符串。
        *   沙箱環境 (Sandbox): `"https://sandbox-api-pay.line.me"`
        *   生產環境 (Production): `"https://api-pay.line.me"`
    *   **注意**：請根據您當前部署的環境（開發、測試、生產）使用正確的 URL。

4.  **`linepay.cloud_function_base_url`** (或 `CLOUD_FUNCTION_BASE_URL`)
    *   **說明**：您部署的 Cloud Functions HTTP 觸發器的基礎 URL。這主要用於 LINE Pay 在某些流程中回調或重定向到您的後端服務時，構造完整的 URL。例如，`/paymentsApiV2/line/user_redirect_after_payment` 端點的完整URL。
    *   **預期值格式**：URL字符串，例如 `"https://us-central1-your-project-id.cloudfunctions.net"` 或您自定義域名指向的 Cloud Functions URL。
    *   **注意**：請確保此 URL 是公開可訪問的，並且指向正確的 Cloud Functions 區域和項目。

5.  **`linepay.customer_pwa_base_url`** (或 `CUSTOMER_PWA_BASE_URL`)
    *   **說明**：顧客點餐PWA (ceg-customer-pwa) 的部署基礎 URL。用於構造 LINE Pay 支付完成或取消後的用戶重定向 URL，例如 `cancelUrl` 和最終的成功/失敗頁面 URL。
    *   **預期值格式**：URL字符串，例如 `"https://your-customer-pwa-domain.com"`。
    *   **注意**：此 URL 應指向已部署且公開可訪問的顧客PWA。

## 其他潛在配置 (示例)

根據未來的功能擴展，可能需要以下類型的配置：

*   **郵件服務 API 金鑰** (例如 SendGrid, Mailgun)
    *   `email.service_provider`: `"sendgrid"`
    *   `email.api_key`: `"SG.xxxxxxxxxxxxxxxxxxxxxx.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"`
*   **短信服務 API 金鑰與密碼** (例如 Twilio)
    *   `sms.account_sid`: `"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"`
    *   `sms.auth_token`: `"your_auth_token"`
    *   `sms.from_number`: `"+1234567890"`

## 配置方法

建議使用 Firebase CLI 進行配置：

```bash
firebase functions:config:set linepay.channel_id="YOUR_CHANNEL_ID"
firebase functions:config:set linepay.channel_secret_key="YOUR_CHANNEL_SECRET"
firebase functions:config:set linepay.api_url="https://sandbox-api-pay.line.me" # 或生產URL
firebase functions:config:set linepay.cloud_function_base_url="YOUR_FUNCTIONS_BASE_URL"
firebase functions:config:set linepay.customer_pwa_base_url="YOUR_PWA_BASE_URL"
# ... 其他配置
```

獲取當前配置：
```bash
firebase functions:config:get
```

在 Cloud Function 中訪問配置 (Node.js):
```javascript
const functions = require('firebase-functions');
const linePayChannelId = functions.config().linepay.channel_id;
// 或者，如果直接設置為環境變量 (不推薦用於敏感信息)
// const linePayChannelId = process.env.LINE_PAY_CHANNEL_ID;
```

確保在部署 Cloud Functions 前已正確設置這些配置。 